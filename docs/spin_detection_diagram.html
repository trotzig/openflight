<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Streaming vs Rolling Buffer Mode</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 40px 20px;
            color: #fff;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            font-size: 2rem;
            margin-bottom: 12px;
            color: #fff;
        }
        .subtitle {
            text-align: center;
            color: #a1a1aa;
            margin-bottom: 40px;
            font-size: 1.1rem;
        }
        .mode-section {
            margin-bottom: 50px;
        }
        .mode-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 20px;
        }
        .mode-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .mode-badge.current {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        }
        .mode-badge.new {
            background: linear-gradient(135deg, #22c55e, #16a34a);
        }
        .mode-title {
            font-size: 1.5rem;
            font-weight: 600;
        }
        .pipeline {
            display: flex;
            align-items: stretch;
            gap: 0;
            background: rgba(255,255,255,0.03);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid rgba(255,255,255,0.1);
            overflow-x: auto;
        }
        .pipeline-step {
            flex: 1;
            min-width: 140px;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }
        .pipeline-step:not(:last-child)::after {
            content: '';
            position: absolute;
            right: -20px;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 3px;
            background: linear-gradient(90deg, #4ade80, transparent);
            z-index: 1;
        }
        .step-icon {
            width: 64px;
            height: 64px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.75rem;
            margin-bottom: 12px;
        }
        .step-icon.radar {
            background: linear-gradient(135deg, #6366f1, #4f46e5);
        }
        .step-icon.internal {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }
        .step-icon.output {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }
        .step-icon.code {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        }
        .step-icon.result {
            background: linear-gradient(135deg, #22c55e, #16a34a);
        }
        .step-icon.raw {
            background: linear-gradient(135deg, #ec4899, #db2777);
        }
        .step-icon.process {
            background: linear-gradient(135deg, #14b8a6, #0d9488);
        }
        .step-icon.spin {
            background: linear-gradient(135deg, #f472b6, #ec4899);
        }
        .step-label {
            font-weight: 600;
            font-size: 0.9rem;
            text-align: center;
            margin-bottom: 6px;
        }
        .step-detail {
            font-size: 0.75rem;
            color: #a1a1aa;
            text-align: center;
            line-height: 1.4;
        }
        .step-detail code {
            background: rgba(0,0,0,0.3);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 0.7rem;
            color: #4ade80;
        }
        .data-box {
            background: #0f0f1a;
            border-radius: 8px;
            padding: 12px;
            margin-top: 12px;
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 0.7rem;
            color: #a1a1aa;
            max-width: 160px;
            word-break: break-all;
        }
        .data-box .key {
            color: #60a5fa;
        }
        .data-box .value {
            color: #4ade80;
        }
        .data-box .comment {
            color: #6b7280;
            font-style: italic;
        }
        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 40px 0;
        }
        .compare-card {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .compare-card h3 {
            font-size: 1rem;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .compare-card h3 .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }
        .compare-card h3 .dot.blue { background: #3b82f6; }
        .compare-card h3 .dot.green { background: #22c55e; }
        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .stat-row:last-child {
            border-bottom: none;
        }
        .stat-label {
            color: #a1a1aa;
            font-size: 0.875rem;
        }
        .stat-value {
            font-weight: 600;
            font-size: 0.875rem;
        }
        .stat-value.blue { color: #60a5fa; }
        .stat-value.green { color: #4ade80; }
        .stat-value.red { color: #f87171; }
        .wave-demo {
            background: #0f0f1a;
            border-radius: 12px;
            padding: 20px;
            margin: 30px 0;
        }
        .wave-demo h3 {
            font-size: 1rem;
            margin-bottom: 16px;
            color: #fff;
        }
        .wave-container {
            height: 100px;
        }
        svg {
            width: 100%;
            height: 100%;
        }
        .axis-label {
            font-size: 10px;
            fill: #6b7280;
        }
        .grid-line {
            stroke: #2d2d3d;
            stroke-width: 1;
        }
        .wave-streaming {
            fill: none;
            stroke: #3b82f6;
            stroke-width: 2;
        }
        .wave-buffer {
            fill: none;
            stroke: #22c55e;
            stroke-width: 2;
        }
        .sample-dot {
            fill: #3b82f6;
        }
        .sample-dot.buffer {
            fill: #22c55e;
        }
        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 12px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.8rem;
            color: #a1a1aa;
        }
        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        .legend-dot.blue { background: #3b82f6; }
        .legend-dot.green { background: #22c55e; }
        .capability-section {
            margin-top: 40px;
        }
        .capability-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }
        .capability-card {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .capability-card .icon {
            font-size: 2rem;
            margin-bottom: 12px;
        }
        .capability-card h4 {
            font-size: 0.9rem;
            margin-bottom: 8px;
        }
        .capability-card p {
            font-size: 0.75rem;
            color: #a1a1aa;
            line-height: 1.5;
        }
        .capability-card.disabled {
            opacity: 0.4;
        }
        .capability-card.enabled {
            border-color: #22c55e;
            background: rgba(34, 197, 94, 0.1);
        }
        .tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.65rem;
            font-weight: 600;
            text-transform: uppercase;
            margin-top: 8px;
        }
        .tag.current { background: #3b82f6; }
        .tag.new { background: #22c55e; }
        .tag.no { background: #ef4444; }
        .footer {
            text-align: center;
            margin-top: 50px;
            padding-top: 30px;
            border-top: 1px solid rgba(255,255,255,0.1);
            color: #6b7280;
            font-size: 0.8rem;
        }
        .code-block {
            background: #0a0a12;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 0.75rem;
            overflow-x: auto;
        }
        .code-block .comment { color: #6b7280; }
        .code-block .keyword { color: #c084fc; }
        .code-block .string { color: #4ade80; }
        .code-block .number { color: #f472b6; }
        .code-block .function { color: #60a5fa; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Streaming Mode vs Rolling Buffer</h1>
        <p class="subtitle">How the radar processes data differently in each mode</p>

        <!-- STREAMING MODE -->
        <div class="mode-section">
            <div class="mode-header">
                <span class="mode-badge current">Current</span>
                <span class="mode-title">Streaming Mode</span>
            </div>
            <div class="pipeline">
                <div class="pipeline-step">
                    <div class="step-icon radar">üì°</div>
                    <div class="step-label">Radar Antenna</div>
                    <div class="step-detail">Receives Doppler-shifted radio waves</div>
                </div>
                <div class="pipeline-step">
                    <div class="step-icon internal">‚öôÔ∏è</div>
                    <div class="step-label">Internal FFT</div>
                    <div class="step-detail">Radar firmware processes 128 samples, runs 4096-pt FFT</div>
                </div>
                <div class="pipeline-step">
                    <div class="step-icon output">üì§</div>
                    <div class="step-label">JSON Output</div>
                    <div class="step-detail">Pre-calculated speeds every ~17ms</div>
                    <div class="data-box">
                        {<span class="key">"speed"</span>: [<span class="value">-142.3</span>],<br>
                        <span class="key">"magnitude"</span>: [<span class="value">847</span>]}
                    </div>
                </div>
                <div class="pipeline-step">
                    <div class="step-icon code">üêç</div>
                    <div class="step-label">Our Code</div>
                    <div class="step-detail">Filter, buffer, find peak speed</div>
                    <div class="data-box">
                        <span class="comment"># launch_monitor.py</span><br>
                        ball = <span class="function">max</span>(readings)
                    </div>
                </div>
                <div class="pipeline-step">
                    <div class="step-icon result">‚õ≥</div>
                    <div class="step-label">Shot Result</div>
                    <div class="step-detail">Ball speed + club speed</div>
                </div>
            </div>
        </div>

        <!-- ROLLING BUFFER MODE -->
        <div class="mode-section">
            <div class="mode-header">
                <span class="mode-badge new">New</span>
                <span class="mode-title">Rolling Buffer Mode</span>
            </div>
            <div class="pipeline">
                <div class="pipeline-step">
                    <div class="step-icon radar">üì°</div>
                    <div class="step-label">Radar Antenna</div>
                    <div class="step-detail">Same Doppler signal reception</div>
                </div>
                <div class="pipeline-step">
                    <div class="step-icon raw">üíæ</div>
                    <div class="step-label">Raw Buffer</div>
                    <div class="step-detail">4096 I/Q samples stored (~136ms of data)</div>
                    <div class="data-box">
                        {<span class="key">"I"</span>: [<span class="value">2048, 2051, ...</span>],<br>
                        <span class="key">"Q"</span>: [<span class="value">2044, 2039, ...</span>]}
                    </div>
                </div>
                <div class="pipeline-step">
                    <div class="step-icon process">üî¨</div>
                    <div class="step-label">Our FFT</div>
                    <div class="step-detail">Overlapping 32-sample windows = 937 Hz resolution</div>
                    <div class="data-box">
                        <span class="comment"># We control the math</span><br>
                        <span class="function">fft</span>(i + j*q, <span class="number">4096</span>)
                    </div>
                </div>
                <div class="pipeline-step">
                    <div class="step-icon spin">üåÄ</div>
                    <div class="step-label">Spin FFT</div>
                    <div class="step-detail">Secondary FFT on speed oscillations</div>
                </div>
                <div class="pipeline-step">
                    <div class="step-icon result">‚õ≥</div>
                    <div class="step-label">Full Result</div>
                    <div class="step-detail">Speed + Spin Rate</div>
                </div>
            </div>
        </div>

        <!-- COMPARISON STATS -->
        <div class="comparison-grid">
            <div class="compare-card">
                <h3><span class="dot blue"></span> Streaming Mode</h3>
                <div class="stat-row">
                    <span class="stat-label">Update Rate</span>
                    <span class="stat-value blue">~56 Hz</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Time Between Samples</span>
                    <span class="stat-value blue">17ms</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Data We Receive</span>
                    <span class="stat-value blue">Processed Speeds</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">FFT Processing</span>
                    <span class="stat-value blue">On-chip (firmware)</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Latency</span>
                    <span class="stat-value green">Real-time</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Spin Detection</span>
                    <span class="stat-value red">Not Possible</span>
                </div>
            </div>
            <div class="compare-card">
                <h3><span class="dot green"></span> Rolling Buffer Mode</h3>
                <div class="stat-row">
                    <span class="stat-label">Update Rate</span>
                    <span class="stat-value green">~937 Hz</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Time Between Samples</span>
                    <span class="stat-value green">1.07ms</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Data We Receive</span>
                    <span class="stat-value green">Raw I/Q Samples</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">FFT Processing</span>
                    <span class="stat-value green">Our code (Python)</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Latency</span>
                    <span class="stat-value blue">Post-capture</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Spin Detection</span>
                    <span class="stat-value green">50-60% Success</span>
                </div>
            </div>
        </div>

        <!-- SAMPLE RESOLUTION VISUALIZATION -->
        <div class="wave-demo">
            <h3>Sample Resolution: Why It Matters</h3>
            <div class="wave-container">
                <svg viewBox="0 0 500 100">
                    <!-- Grid lines -->
                    <line x1="50" y1="20" x2="50" y2="80" class="grid-line"/>
                    <line x1="150" y1="20" x2="150" y2="80" class="grid-line"/>
                    <line x1="250" y1="20" x2="250" y2="80" class="grid-line"/>
                    <line x1="350" y1="20" x2="350" y2="80" class="grid-line"/>
                    <line x1="450" y1="20" x2="450" y2="80" class="grid-line"/>

                    <!-- Time labels -->
                    <text x="50" y="95" class="axis-label" text-anchor="middle">0ms</text>
                    <text x="150" y="95" class="axis-label" text-anchor="middle">17ms</text>
                    <text x="250" y="95" class="axis-label" text-anchor="middle">34ms</text>
                    <text x="350" y="95" class="axis-label" text-anchor="middle">51ms</text>
                    <text x="450" y="95" class="axis-label" text-anchor="middle">68ms</text>

                    <!-- Actual speed curve (what's really happening) -->
                    <path d="M30,50 Q80,50 100,45 Q120,35 140,20 Q160,15 180,18 Q220,22 260,25 Q300,28 340,30 Q380,32 420,33 Q460,34 480,35"
                          fill="none" stroke="#4b5563" stroke-width="1" stroke-dasharray="4,4"/>

                    <!-- Streaming mode samples (only at 17ms intervals) -->
                    <circle cx="50" cy="50" r="6" class="sample-dot"/>
                    <circle cx="150" cy="38" r="6" class="sample-dot"/>
                    <circle cx="250" cy="25" r="6" class="sample-dot"/>
                    <circle cx="350" cy="30" r="6" class="sample-dot"/>
                    <circle cx="450" cy="34" r="6" class="sample-dot"/>

                    <!-- Rolling buffer samples (many more points) -->
                    <circle cx="50" cy="50" r="3" class="sample-dot buffer"/>
                    <circle cx="67" cy="48" r="3" class="sample-dot buffer"/>
                    <circle cx="84" cy="47" r="3" class="sample-dot buffer"/>
                    <circle cx="101" cy="44" r="3" class="sample-dot buffer"/>
                    <circle cx="118" cy="36" r="3" class="sample-dot buffer"/>
                    <circle cx="135" cy="22" r="3" class="sample-dot buffer"/>
                    <circle cx="152" cy="18" r="3" class="sample-dot buffer"/>
                    <circle cx="169" cy="17" r="3" class="sample-dot buffer"/>
                    <circle cx="186" cy="19" r="3" class="sample-dot buffer"/>
                    <circle cx="203" cy="21" r="3" class="sample-dot buffer"/>
                    <circle cx="220" cy="23" r="3" class="sample-dot buffer"/>
                    <circle cx="237" cy="24" r="3" class="sample-dot buffer"/>
                    <circle cx="254" cy="25" r="3" class="sample-dot buffer"/>
                    <circle cx="271" cy="26" r="3" class="sample-dot buffer"/>
                    <circle cx="288" cy="27" r="3" class="sample-dot buffer"/>
                    <circle cx="305" cy="28" r="3" class="sample-dot buffer"/>

                    <!-- Labels -->
                    <text x="15" y="25" class="axis-label">Fast</text>
                    <text x="15" y="55" class="axis-label">Slow</text>

                    <!-- Impact marker -->
                    <line x1="135" y1="15" x2="135" y2="85" stroke="#f472b6" stroke-width="2" stroke-dasharray="4,2"/>
                    <text x="135" y="12" fill="#f472b6" font-size="9" text-anchor="middle">IMPACT</text>
                </svg>
            </div>
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-dot blue"></div>
                    <span>Streaming: 5 samples in 68ms</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot green"></div>
                    <span>Rolling Buffer: 16 samples in 68ms</span>
                </div>
            </div>
        </div>

        <!-- RADAR COMMANDS -->
        <div class="compare-card" style="margin: 30px 0;">
            <h3 style="margin-bottom: 16px;">Radar Configuration Commands</h3>
            <div class="code-block">
<span class="comment"># Current: Streaming Mode (configure_for_golf)</span>
<span class="keyword">S=30</span>    <span class="comment"># 30ksps sample rate</span>
<span class="keyword">S(</span>      <span class="comment"># 128 buffer size</span>
<span class="keyword">X=32</span>    <span class="comment"># FFT multiplier (128 x 32 = 4096)</span>
<span class="keyword">O4</span>      <span class="comment"># Report up to 4 objects</span>
<span class="keyword">K+</span>      <span class="comment"># Peak averaging on</span>
<span class="keyword">OJ</span>      <span class="comment"># JSON output</span>
<span class="comment"># Radar does FFT internally, sends speeds</span>

<span class="comment"># New: Rolling Buffer Mode</span>
<span class="keyword">PI</span>      <span class="comment"># Idle mode first</span>
<span class="keyword">G1</span>      <span class="comment"># Enable rolling buffer (4096 samples)</span>
<span class="keyword">S!</span>      <span class="comment"># Trigger: dump raw I/Q data</span>
<span class="comment"># We receive raw samples, run our own FFT</span>
            </div>
        </div>

        <!-- CAPABILITIES -->
        <div class="capability-section">
            <h3 style="margin-bottom: 20px; font-size: 1.1rem;">What Each Mode Enables</h3>
            <div class="capability-grid">
                <div class="capability-card">
                    <div class="icon">üèåÔ∏è</div>
                    <h4>Ball Speed</h4>
                    <p>Detect peak ball velocity after impact</p>
                    <span class="tag current">Both Modes</span>
                </div>
                <div class="capability-card">
                    <div class="icon">üèí</div>
                    <h4>Club Speed</h4>
                    <p>Detect club head speed before impact</p>
                    <span class="tag current">Both Modes</span>
                </div>
                <div class="capability-card">
                    <div class="icon">‚ö°</div>
                    <h4>Real-time Display</h4>
                    <p>Instant feedback as you swing</p>
                    <span class="tag current">Streaming Only</span>
                </div>
                <div class="capability-card enabled">
                    <div class="icon">üåÄ</div>
                    <h4>Spin Rate</h4>
                    <p>Backspin from dimple oscillations</p>
                    <span class="tag new">Rolling Buffer</span>
                </div>
                <div class="capability-card enabled">
                    <div class="icon">üéØ</div>
                    <h4>Precise Impact Timing</h4>
                    <p>Millisecond-accurate event detection</p>
                    <span class="tag new">Rolling Buffer</span>
                </div>
                <div class="capability-card enabled">
                    <div class="icon">üìä</div>
                    <h4>Raw Signal Analysis</h4>
                    <p>Full control over DSP pipeline</p>
                    <span class="tag new">Rolling Buffer</span>
                </div>
            </div>
        </div>

        <div class="footer">
            <strong>OpenFlight</strong> - DIY Golf Launch Monitor<br>
            Rolling buffer spin detection: ~50-60% success rate per OmniPreSense<br>
            <span style="color: #4ade80;">github.com/omnipresense/rolling_buffer</span>
        </div>
    </div>
</body>
</html>
